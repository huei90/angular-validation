angular.module("validation",["validation.provider","validation.directive"]);angular.module("validation.provider",[]);angular.module("validation.directive",["validation.provider"]),function(){function n(){var i,n,s,r,u,t=this,h=function(t){i=t;n=i.get("$rootScope");s=i.get("$http");r=i.get("$q");u=i.get("$timeout")},f={},e=null,o={};this.setExpression=function(n){return angular.extend(f,n),t};this.getExpression=function(n){return f[n]};this.setDefaultMsg=function(n){return angular.extend(o,n),t};this.getDefaultMsg=function(n){return o[n]};this.setValidMethod=function(n){e=n};this.getValidMethod=function(){return e};this.setErrorHTML=function(n){if(n.constructor===Function)return t.getErrorHTML=n,t};this.getErrorHTML=function(n){return'<p class="validation-invalid">'+n+"<\/p>"};this.setSuccessHTML=function(n){if(n.constructor===Function)return t.getSuccessHTML=n,t};this.getSuccessHTML=function(n){return'<p class="validation-valid">'+n+"<\/p>"};this.showSuccessMessage=!0;this.showErrorMessage=!0;this.checkValid=function(n){return!!(n&&n.$valid)};this.validate=function(i){var f=r.defer(),o=0,s,e;if(i===undefined)return console.error("This is not a regular Form name scope"),f.reject("This is not a regular Form name scope"),f.promise;if(i.validationId)n.$broadcast(i.$name+"submit-"+i.validationId,o++);else if(i.constructor===Array)for(s in i)n.$broadcast(i[s].$name+"submit-"+i[s].validationId,o++);else for(e in i)e[0]!=="$"&&i[e].hasOwnProperty("$dirty")&&n.$broadcast(e+"submit-"+i[e].validationId,o++);return f.promise.success=function(n){return f.promise.then(function(t){n(t)}),f.promise},f.promise.error=function(n){return f.promise.then(null,function(t){n(t)}),f.promise},u(function(){t.checkValid(i)?f.resolve("success"):f.reject("error")}),f.promise};this.validCallback=null;this.invalidCallback=null;this.resetCallback=null;this.reset=function(t){var r,i;if(t===undefined){console.error("This is not a regular Form name scope");return}if(t.validationId)n.$broadcast(t.$name+"reset-"+t.validationId);else if(t.constructor===Array)for(r in t)n.$broadcast(t[r].$name+"reset-"+t[r].validationId);else for(i in t)i[0]!=="$"&&t[i].hasOwnProperty("$dirty")&&n.$broadcast(i+"reset-"+t[i].validationId)};this.addMsgElement=function(n){return n.after("<span><\/span>")};this.getMsgElement=function(n){return n.next()};this.$get=["$injector",function(n){return h(n),{setValidMethod:this.setValidMethod,getValidMethod:this.getValidMethod,setErrorHTML:this.setErrorHTML,getErrorHTML:this.getErrorHTML,setSuccessHTML:this.setSuccessHTML,getSuccessHTML:this.getSuccessHTML,setExpression:this.setExpression,getExpression:this.getExpression,setDefaultMsg:this.setDefaultMsg,getDefaultMsg:this.getDefaultMsg,showSuccessMessage:this.showSuccessMessage,showErrorMessage:this.showErrorMessage,checkValid:this.checkValid,validate:this.validate,validCallback:this.validCallback,invalidCallback:this.invalidCallback,resetCallback:this.resetCallback,reset:this.reset,addMsgElement:this.addMsgElement,getMsgElement:this.getMsgElement}}]}angular.module("validation.provider").provider("$validation",n)}.call(this),function(){function n(n){var t=n.get("$validation"),i=n.get("$timeout"),r=n.get("$parse");return{link:function(n,u,f){var e=r(f.validationReset)(n);i(function(){u.on("click",function(n){n.preventDefault();t.reset(e)})})}}}angular.module("validation.directive").directive("validationReset",n);n.$inject=["$injector"]}.call(this),function(){function n(n){var i=n.get("$validation"),r=n.get("$timeout"),t=n.get("$parse");return{priority:1,require:"?ngClick",link:function(n,u,f){var e=t(f.validationSubmit)(n);r(function(){u.off("click");u.on("click",function(r){r.preventDefault();i.validate(e).success(function(){t(f.ngClick)(n)})})})}}}angular.module("validation.directive").directive("validationSubmit",n);n.$inject=["$injector"]}.call(this),function(){function n(n){function r(n,t,i){for(var u=document.querySelectorAll("*[validation-group="+t+"]"),r=0,o=u.length;r<o;r++){var f=u[r],s=f.form.name,e=f.name;n[s][e].$setValidity(e,i)}}function y(n){var t={};return n&&n.length>0?(t=n[0],angular.isObject(t)||(t={result:t,message:""})):t={result:!1,message:""},t}var t=n.get("$validation"),l=n.get("$q"),o=n.get("$timeout"),s=n.get("$compile"),h=n.get("$parse"),i={},a=function(n,i,r,u,f,e){var l=r+"SuccessMessage",c=e[l]!==null&&e[l]!==undefined?i||t.getDefaultMsg(r).success:"",y=h(e.validCallback),a=e.messageId,v=e.validationGroup,o;return o=a||v?angular.element(document.querySelector("#"+(a||v))):t.getMsgElement(n),n.attr("no-validation-message")?o.css("display","none"):t.showSuccessMessage&&c?(o.html("").append(s(t.getSuccessHTML(c,n,e))(u)),o.css("display","")):o.css("display","none"),f.$setValidity(f.$name,!0),y(u,{message:c}),t.validCallback&&t.validCallback(n),!0},v=function(n,i,r,u,f,e){var c=i||t.getDefaultMsg(r).error,v=h(e.invalidCallback),l=e.messageId,a=e.validationGroup,o;return o=l||a?angular.element(document.querySelector("#"+(l||a))):t.getMsgElement(n),n.attr("no-validation-message")?o.css("display","none"):t.showErrorMessage&&c?(o.html("").append(s(t.getErrorHTML(c,n,e))(u)),o.css("display","")):o.css("display","none"),f.$setValidity(f.$name,!1),v(u,{message:c}),t.invalidCallback&&t.invalidCallback(n),!1},c=function(n){var t=i[n];return Object.keys(t).some(function(n){return t[n]})},f={},u=function(n,f,e,o,s,h){var tt=s.slice(0),k=tt[0].trim(),d=k.indexOf("="),w=d===-1?k:k.substr(0,d),it=d===-1?null:k.substr(d+1),g=tt.slice(1),rt=w+"SuccessMessage",ut=w+"ErrorMessage",nt=t.getExpression(w),p=e.validationGroup,b={success:function(t){return a(f,t||e[rt],w,n,o,e),g.length?u(n,f,e,o,g,h):!0},error:function(t){return v(f,t||e[ut],w,n,o,e)}};if(nt===undefined)return(console.error('You are using undefined validator "%s"',w),g.length)?u(n,f,e,o,g,h):void 0;if(nt.constructor===Function)return l.all([t.getExpression(w)(h,n,f,e,it)]).then(function(t){var f=y(t),u=f.message;if(f.result)return p&&(i[p][o.$name]=!0,r(n,p,!0)),b.success(u);if(p)if(i[p][o.$name]=!1,c(p))r(n,p,!0);else return r(n,p,!1),b.error(u);else return b.error(u)},function(){return b.error()});if(nt.constructor===RegExp){if(h!==undefined&&h!==null){if(t.getExpression(w).test(h))return p&&(i[p][o.$name]=!0,r(n,p,!0)),b.success();if(p)if(i[p][o.$name]=!1,c(p))r(n,p,!0);else return r(n,p,!1),b.error();else return b.error()}}else return b.error()},e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},p=function(){return e()+e()+e()+e()};return{restrict:"A",require:"ngModel",link:function(n,r,e,s){var d=e.validator,c=e.messageId,h=e.validationGroup,l=e.validMethod,v=e.ngModel,y=function(){},a=d.split(","),w=s.validationId=p(),b=null,k;if(typeof n.initialValidity=="boolean"&&(k=n.initialValidity),h&&(i[h]||(i[h]={}),i[h][s.$name]=!1),c||h||t.addMsgElement(r),s.$setValidity(s.$name,k),n.$on(s.$name+"reset-"+w,function(){y();o(function(){s.$setViewValue(b);s.$setPristine();s.$setValidity(s.$name,undefined);s.$render();c||h?angular.element(document.querySelector("#"+(c||h))).html(""):t.getMsgElement(r).html("");t.resetCallback&&t.resetCallback(r)})}),l=angular.isUndefined(l)?t.getValidMethod():l,n.$on(s.$name+"submit-"+w,function(t,i){var p=s.$viewValue,h=!1,c;h=u(n,r,e,s,a,p);l==="submit"&&(y(),y=n.$watch(function(){return n.$eval(v)},function(t,i){t!==i&&((t===undefined||t===null)&&(t=""),h=u(n,r,e,s,a,t))}));c=function(n){n?delete f[i]:(f[i]=r[0],o(function(){f[Math.min.apply(null,Object.keys(f))].focus()},0))};h.constructor===Object?h.then(c):c(h)}),l==="blur"){r.bind("blur",function(){var t=n.$eval(v);n.$apply(function(){u(n,r,e,s,a,t)})});return}l!=="submit"&&l!=="submit-only"&&(n.$watch(function(){return n.$eval(v)},function(i){if(s.$pristine&&s.$viewValue)b=s.$viewValue||"",s.$setViewValue(s.$viewValue);else if(s.$pristine){c||h?angular.element(document.querySelector("#"+(c||h))).html(""):t.getMsgElement(r).html("");return}u(n,r,e,s,a,i)}),o(function(){e.$observe("noValidationMessage",function(n){var i;i=c||h?angular.element(document.querySelector("#"+(c||h))):t.getMsgElement(r);n==="true"||n===!0?i.css("display","none"):(n==="false"||n===!1)&&i.css("display","block")})}))}}}angular.module("validation.directive").directive("validator",n);n.$inject=["$injector"]}.call(this);